{% extends 'estate/base.html' %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'estate/css/view.css' %}">
{% endblock %}

{% block content %}

<div class="page-header">
  <div class="container">
    <h1><i class="fas fa-comments"></i> User Feedback</h1>
    <p>Review and manage feedback from your users</p>
  </div>
</div>

<div class="container feedback-container">
  <div class="row justify-content-center">
    <div class="col-lg-10">

      <!-- Stats Card -->
      <div class="stats-card">
        <div class="stat-box">
          <i class="fas fa-comment-dots"></i>
          <div class="stat-info">
            <span class="stat-number">{{ feedback|length }}</span>
            <span class="stat-label">Total Feedback</span>
          </div>
        </div>
        <div class="stat-box">
          <i class="fas fa-calendar-day"></i>
          <div class="stat-info">
            <span class="stat-number">{{ feedback|length }}</span>
            <span class="stat-label">This Month</span>
          </div>
        </div>
        <div class="stat-box">
          <i class="fas fa-users"></i>
          <div class="stat-info">
            <span class="stat-number">{{ feedback|length }}</span>
            <span class="stat-label">Unique Users</span>
          </div>
        </div>
      </div>

      <!-- Feedback List -->
      {% if feedback %}
        <div class="feedback-list">
          {% for item in feedback %}
            <div class="feedback-card">
              <div class="feedback-header">
                <div class="user-info">
                  <div class="avatar">
                    <i class="fas fa-user"></i>
                  </div>
                  <div class="user-details">
                    <h4 class="user-email">{{ item.email }}</h4>
                    <span class="feedback-date">
                      <i class="far fa-calendar"></i> {{ item.date_sent|date:"F d, Y" }}
                    </span>
                  </div>
                </div>
                <div class="feedback-id">#{{ item.id }}</div>
              </div>

              <div class="feedback-content">
                <div class="feedback-icon">
                  <i class="fas fa-quote-left"></i>
                </div>
                <p class="feedback-text">{{ item.feedback }}</p>
              </div>

              <div class="feedback-actions">
                <button class="btn-action reply" onclick="replyTo('{{ item.email }}')">
                  <i class="fas fa-reply"></i> Reply
                </button>
                <button class="btn-action archive">
                  <i class="fas fa-archive"></i> Archive
                </button>
                    <a href="{% url 'delete-feedback' feedback_id=item.id %}" class="btn-delete">
                      <i class="bi bi-trash-fill me-1"></i>
                      Delete
                    </a>
              </div>
            </div>
          {% endfor %}
        </div>

        <!-- Pagination (if needed) -->
        <div class="pagination-info">
          <p>Showing {{ feedback|length }} of {{ feedback|length }} feedbacks</p>
        </div>

      {% else %}
        <div class="no-feedback">
          <div class="no-feedback-icon">
            <i class="fas fa-inbox"></i>
          </div>
          <h3>No Feedback Yet</h3>
          <p>When users submit feedback, it will appear here</p>
        </div>
      {% endif %}

    </div>
  </div>
</div>

<script>
  function replyTo(email) {
    window.location.href = `mailto:${email}?subject=Re: Your Feedback on Estate Web`;
  }

  function deleteFeedback(id) {
    if (confirm('Are you sure you want to delete this feedback? This action cannot be undone.')) {
      // Add your delete logic here
      alert(`Feedback #${id} will be deleted`);
    }
  }
</script>

{% endblock %}