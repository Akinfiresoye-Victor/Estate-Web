{% extends 'estate/base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'estate/css/search.css' %}">
{% endblock %}

{% block content %}
<div class="page-header">
  <div class="container">
    <h1>Search Results</h1>
    <p>Properties matching your query</p>
  </div>
</div>

<div class="container mb-5">
  {% if searched %}
    <div class="search-results-header">
      <h2 class="text-center mb-4">Results for "{{ searched }}"</h2>
      <hr class="mb-5">
    </div>

    {% if on_sale %}
      <div class="row g-4">
        <div class="col-12">
          <h3 class="section-title sale-section">Properties for Sale</h3>
        </div>
        {% for sale in on_sale %}
          <div class="col-md-6 col-lg-4">
            <div class="card property-card h-100 sale-card">
              <div class="property-image">
                <div class="property-status sale-status">For Sale</div>
                {% if sale.image %}
                  <img src="{{ sale.image.url }}" class="card-img" alt="{{ sale.title }}">
                {% else %}
                  <div class="placeholder-image sale-placeholder"></div>
                {% endif %}
              </div>
              <div class="card-body d-flex flex-column">
                <h5 class="property-title sale-title">{{ sale.summary }}</h5>
                <div class="property-location sale-accent">
                  <i class="fas fa-map-marker-alt"></i>
                  <span>{{ sale.location }}</span>
                </div>
                <div class="property-price sale-price">₦{{ sale.price }}</div>
                <p class="property-description">{{ sale.title|truncatewords:10 }}</p>
                <div class="mt-auto">
                  <a href="{% url 'view-property-s' sale.id %}" class="btn btn-view-property sale-btn">
                    View Details
                  </a>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    {% if on_lease %}
      <div class="row g-4 mt-5">
        <div class="col-12">
          <h3 class="section-title lease-section">Properties for Lease</h3>
        </div>
        {% for lease in on_lease %}
          <div class="col-md-6 col-lg-4">
            <div class="card property-card h-100 lease-card">
              <div class="property-image">
                <div class="property-status lease-status">For Lease</div>
                {% if lease.image %}
                  <img src="{{ lease.image.url }}" class="card-img" alt="{{ lease.title }}">
                {% else %}
                  <div class="placeholder-image lease-placeholder"></div>
                {% endif %}
              </div>
              <div class="card-body d-flex flex-column">
                <h5 class="property-title lease-title">{{ lease.summary }}</h5>
                <div class="property-location lease-accent">
                  <i class="fas fa-map-marker-alt"></i>
                  <span>{{ lease.location }}</span>
                </div>
                <div class="property-price lease-price">₦{{ lease.price_range }}/month</div>
                <p class="property-description">{{ lease.summary|truncatewords:10 }}</p>
                <div class="mt-auto">
                  <a href="{% url 'view-property-r' lease.id %}" class="btn btn-view-property lease-btn">
                    View Details
                  </a>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    {% if not on_sale and not on_lease %}
      <div class="col-12">
        <div class="no-properties">
          <i class="fas fa-search"></i>
          <h3>No Results Found</h3>
          <p>No properties match your search for "{{ searched }}". Try different keywords or check our 
            <a href="{% url 'rent-prop' %}" class="text-primary text-decoration-none">Properties On Lease</a>
            or <a href="{% url 'buy-property' %}" class="text-primary text-decoration-none">Properties On Sale</a>
            for featured listings.
          </p>
        </div>
      </div>
    {% endif %}

  {% else %}
    <div class="col-12">
      <div class="no-properties invalid-search text-center">
        <i class="fas fa-exclamation-triangle"></i>
        <h3>Invalid Search</h3>
        <p>Please enter a valid search term to continue.</p>
        <a href="{% url 'user-profile' %}" class="btn btn-primary mt-3">Dashboard</a>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}
